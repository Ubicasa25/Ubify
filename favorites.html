<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mis Favoritos | Ubify</title>
  <meta name="description" content="Revisa tus propiedades favoritas en Ubify. Contacta directamente con los propietarios." />
  <meta name="keywords" content="favoritos, propiedades guardadas, Villa Ángela, inmobiliaria" />
  <link rel="icon" type="image/png" href="logo-negro-sinfondo-pestaña.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&display=swap" rel="stylesheet" />
  <style>
    body { 
      font-family: 'Montserrat', sans-serif; 
      background-color: #f8fafc;
      color: #1f2937; 
    }
    h1, h2, h3, h4, .font-playfair {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      color: #1f2937;
    }
    .font-inter {
      font-family: 'Inter', sans-serif;
    }
    .property-card {
      background: linear-gradient(145deg, #ffffff, #f8fafc);
      border: 1px solid #e2e8f0;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 1.25rem;
      overflow: hidden;
      height: 100%;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    .property-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #3b82f6, #8b5cf6);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 1;
    }
    .property-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }
    .property-card:hover::before {
      opacity: 1;
    }
    .property-card .card-image {
      height: 220px;
      overflow: hidden;
      position: relative;
    }
    .property-card .card-image::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 30px;
      background: linear-gradient(transparent, rgba(0, 0, 0, 0.1));
    }
    .property-card .card-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 1.5rem;
    }
    .property-card .card-content .card-body {
      flex: 1;
    }
    .property-card .card-content .card-footer {
      margin-top: auto;
      padding-top: 1.25rem;
      border-top: 1px solid #f1f5f9;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      margin: 1.25rem -1.5rem -1.5rem -1.5rem;
      padding: 1.25rem 1.5rem 1.5rem 1.5rem;
    }
    .favorite-btn {
      background-color: white;
      border-radius: 50%;
      width: 2.5rem;
      height: 2.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: all 0.2s;
      border: none;
      cursor: pointer;
    }
    .favorite-btn:hover {
      background-color: #f0f0f0;
      transform: scale(1.1);
    }
    .favorite-btn.favorited {
      background-color: #ef4444;
    }
    .favorite-btn.favorited svg {
      fill: white;
      stroke: white;
    }
    .favorite-btn svg {
      width: 1.2rem;
      height: 1.2rem;
      stroke: #4b5563;
      fill: none;
    }
    .btn-primary {
      background-image: linear-gradient(to right, #2563eb, #1d4ed8);
      color: #ffffff;
      transition: background 0.3s ease;
    }
    .btn-primary:hover {
      background-image: linear-gradient(to right, #1d4ed8, #1e40af);
    }
    .btn-secondary {
      background-color: #10b981;
      color: #ffffff;
    }
    .btn-secondary:hover {
      background-color: #059669;
    }
    .btn-tertiary {
      background-color: #ffffff;
      color: #2563eb;
      border: 2px solid #2563eb;
      transition: all 0.3s ease;
    }
    .btn-tertiary:hover {
      background-color: #f0f5ff;
      transform: translateY(-2px);
    }
    .animate-fade-in {
      animation: fadeIn 1s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .animate-slide-up {
      animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .animate-slide-down {
      animation: slideDown 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    @keyframes slideUp {
      from { 
        transform: translateY(100%); 
        opacity: 0; 
      }
      to { 
        transform: translateY(0); 
        opacity: 1; 
      }
    }
    @keyframes slideDown {
      from { 
        transform: translateY(0); 
        opacity: 1; 
      }
      to { 
        transform: translateY(100%); 
        opacity: 0; 
      }
    }
    
    /* Mejoras para móviles */
    @media (max-width: 640px) {
      .toast-notification {
        border-radius: 0.75rem;
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
      }
    }
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .empty-state {
      text-align: center;
      padding: 2rem 1rem;
      color: #6b7280;
    }
    .empty-state svg {
      margin: 0 auto 1rem;
      color: #d1d5db;
    }
    
    /* Mejoras para móviles */
    @media (max-width: 640px) {
      .property-card {
        margin-bottom: 0.5rem;
        border-radius: 0.75rem;
      }
      .property-card .card-image {
        height: 160px;
      }
      .property-card .card-content {
        padding: 1rem;
      }
      .property-card .card-content .card-body {
        padding: 0.75rem 0;
      }
      .property-card .card-content .card-footer {
        padding: 0.5rem 0;
        margin: 1rem -1rem -1rem -1rem;
        padding: 1rem;
      }
      .property-card h4 {
        font-size: 1rem;
        margin-bottom: 0.75rem;
      }
      .property-card p {
        font-size: 0.875rem;
        margin-bottom: 0.75rem;
      }
      .property-card .text-xl {
        font-size: 1.125rem;
      }
      .property-card .flex-wrap.gap-2 {
        gap: 0.5rem;
        margin-bottom: 0.75rem;
      }
      .property-card .flex-wrap.gap-2 span {
        padding: 0.375rem 0.75rem;
        font-size: 0.75rem;
      }
      .property-card .flex.gap-2 {
        gap: 0.5rem;
      }
      .property-card .flex.gap-2 a,
      .property-card .flex.gap-2 button {
        padding: 0.75rem;
        font-size: 0.875rem;
      }
      .favorite-btn {
        width: 2.25rem;
        height: 2.25rem;
        top: 0.75rem;
        right: 0.75rem;
      }
      .favorite-btn svg {
        width: 1rem;
        height: 1rem;
      }
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-inter">
  <!-- Header -->
  <header class="bg-gradient-to-r from-white via-blue-50 to-purple-50 shadow-lg border-b border-gray-200 relative overflow-hidden">
    <!-- Background decoration -->
    <div class="absolute inset-0 bg-gradient-to-r from-blue-500/5 via-purple-500/5 to-blue-500/5"></div>
    <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-400/10 to-purple-400/10 rounded-full -translate-y-16 translate-x-16"></div>
    <div class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-purple-400/10 to-blue-400/10 rounded-full translate-y-12 -translate-x-12"></div>
    
    <div class="max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 sm:py-6 relative z-10">
      <!-- Mobile Layout -->
      <div class="block sm:hidden">
        <div class="flex items-center justify-between mb-4">
          <a href="index.html" class="flex items-center bg-white/80 backdrop-blur-sm text-gray-700 hover:text-blue-600 hover:bg-blue-50 px-4 py-2 rounded-xl font-medium text-sm transition-all duration-300 shadow-sm hover:shadow-md">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" />
            </svg>
            Volver
          </a>
        </div>
        <div class="text-center">
          <div class="inline-flex items-center bg-white/90 backdrop-blur-sm px-6 py-3 rounded-2xl shadow-lg border border-white/50">
            <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-3">
              <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
              </svg>
            </div>
            <div>
              <h1 class="text-lg font-montserrat font-bold text-gray-800">Mis Favoritos</h1>
              <p class="text-xs text-gray-500">Tu colección personal</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Desktop Layout -->
      <div class="hidden sm:flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <a href="index.html" class="bg-white/80 backdrop-blur-sm text-gray-700 hover:text-blue-600 hover:bg-blue-50 px-6 py-3 rounded-xl font-semibold text-sm font-montserrat flex items-center transition-all duration-300 shadow-sm hover:shadow-md">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" />
            </svg>
            Volver al inicio
          </a>
        </div>
        <div class="absolute left-1/2 transform -translate-x-1/2">
          <div class="flex items-center bg-white/90 backdrop-blur-sm px-6 py-4 rounded-2xl shadow-lg border border-white/50">
            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-4">
              <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
                <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
              </svg>
            </div>
            <div>
              <h1 class="text-xl font-montserrat font-bold text-gray-800">Mis Favoritos</h1>
              <p class="text-sm text-gray-500">Tu colección personal</p>
            </div>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <!-- Espacio vacío para mantener el balance -->
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="py-4 sm:py-8 px-3 sm:px-4 min-h-[60vh] flex flex-col">
    <div class="max-w-7xl mx-auto">
      <!-- Loading State -->
      <div id="loadingState" class="text-center py-16">
        <div class="inline-flex flex-col items-center space-y-4">
          <div class="relative">
            <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>
            <div class="absolute inset-0 flex items-center justify-center">
              <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
              </svg>
            </div>
          </div>
          <div class="text-center">
            <h3 class="text-lg font-montserrat font-semibold text-gray-800 mb-2">Cargando tus favoritos</h3>
            <p class="text-gray-500 text-sm">Un momento, estamos preparando tu lista...</p>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div id="emptyState" class="empty-state hidden flex-1 flex flex-col items-center justify-center text-center py-8 sm:py-16">
        <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-2xl sm:rounded-3xl p-4 sm:p-8 max-w-sm sm:max-w-md mx-auto shadow-lg border border-blue-100">
          <div class="relative mb-4 sm:mb-6">
            <div class="w-16 h-16 sm:w-20 sm:h-20 mx-auto bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center">
              <svg class="h-8 w-8 sm:h-10 sm:w-10 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
                <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
              </svg>
            </div>
            <div class="absolute -top-1 -right-1 sm:-top-2 sm:-right-2 w-5 h-5 sm:w-6 sm:h-6 bg-yellow-400 rounded-full flex items-center justify-center">
              <svg class="w-2.5 h-2.5 sm:w-3 sm:h-3 text-yellow-800" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
              </svg>
            </div>
          </div>
          <h2 class="text-lg sm:text-xl font-montserrat font-bold text-gray-800 mb-2 sm:mb-3">¡Tu lista de favoritos está vacía!</h2>
          <p class="text-gray-600 mb-6 sm:mb-8 text-xs sm:text-sm leading-relaxed">Explora nuestras propiedades y marca con el corazón las que más te gusten. Así podrás encontrarlas fácilmente después.</p>
          <div class="space-y-2 sm:space-y-3">
            <a href="index.html" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-4 py-2 rounded-lg font-medium text-sm font-montserrat inline-flex items-center justify-center w-full sm:w-auto shadow-md hover:shadow-lg transition-all duration-300 hover:from-blue-600 hover:to-purple-700">
              Explorar propiedades
            </a>
            <p class="text-xs text-gray-500">💡 Tip: Haz clic en el corazón de las propiedades que te gusten</p>
          </div>
        </div>
      </div>

      <!-- Favorites Grid -->
      <div id="favoritesGrid" class="grid gap-4 sm:gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 hidden flex-1">
        <!-- Las propiedades se insertarán aquí -->
      </div>

      <!-- Actions Bar -->
      <div id="actionsBar" class="mt-8 bg-gradient-to-r from-white to-gray-50 rounded-2xl shadow-lg border border-gray-200 p-6 sm:p-8 hidden">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-6">
          <div class="text-center sm:text-left">
            <div class="flex items-center justify-center sm:justify-start">
              <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-3">
                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
              </div>
              <h3 class="text-lg font-montserrat font-semibold text-gray-800">Tu colección de favoritos</h3>
            </div>
          </div>
          <div class="flex flex-col sm:flex-row gap-3">
            <button id="clearAllFavoritesBottom" class="bg-gradient-to-r from-red-500 to-red-600 text-white hover:from-red-600 hover:to-red-700 px-6 py-3 rounded-xl font-semibold text-sm flex items-center justify-center transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 hidden">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
              Limpiar todo
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

<footer id="mainFooter" class="bg-gray-100 py-8 sm:py-10 px-3 sm:px-4 border-t border-gray-200 hidden">
  <div class="max-w-6xl mx-auto grid grid-cols-1 gap-6 sm:gap-8 sm:grid-cols-3 text-center sm:text-left">
    <div class="border-b sm:border-b-0 sm:border-r border-gray-300 pb-4 sm:pb-0 sm:pr-6">
      <h3 class="text-lg sm:text-xl font-montserrat font-semibold mb-3 sm:mb-4 text-gray-800">Ubify</h3>
      <p class="text-gray-600 text-sm sm:text-base font-inter">Propiedades en toda la zona. Encontrá tu espacio o publicá el tuyo.</p>
    </div>
    <div class="border-b sm:border-b-0 sm:border-r border-gray-300 pb-4 sm:pb-0 sm:pr-6">
      <h3 class="text-lg sm:text-xl font-montserrat font-semibold mb-3 sm:mb-4 text-gray-800">Contáctanos</h3>
      <p class="text-gray-600 text-sm sm:text-base font-inter mb-3">¿Querés publicar una propiedad?</p>
      <a href="https://wa.me/+543735308294?text=Hola,%20quiero%20publicar%20una%20propiedad%20en%20Ubify" target="_blank" class="inline-flex items-center justify-center bg-green-500 text-white px-4 py-2 rounded-lg font-semibold text-sm sm:text-base hover:bg-green-600 transition duration-300 font-inter w-full sm:w-auto">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/whatsapp.svg" alt="WhatsApp" class="w-4 h-4 sm:w-5 sm:h-5 mr-2 invert" />
        Quiero publicar
      </a>
    </div>
    <div>
      <h3 class="text-lg sm:text-xl font-montserrat font-semibold mb-3 sm:mb-4 text-gray-800">¡Seguinos!</h3>
      <div class="flex justify-center sm:justify-start space-x-6">
        <a href="https://www.facebook.com/" target="_blank" class="hover:scale-110 transition-transform">
          <img src="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/facebook.svg" alt="Facebook" class="w-5 h-5 sm:w-6 sm:h-6 text-[#1877F2]" />
        </a>
        <a href="https://www.instagram.com/" target="_blank" class="hover:scale-110 transition-transform">
          <img src="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/instagram.svg" alt="Instagram" class="w-5 h-5 sm:w-6 sm:h-6 text-[#E4405F]" />
        </a>
        <a href="https://wa.me/+543735308294?text=Hola,%20quiero%20más%20información%20sobre%20Ubify" target="_blank" class="hover:scale-110 transition-transform">
          <img src="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/whatsapp.svg" alt="WhatsApp" class="w-5 h-5 sm:w-6 sm:h-6 text-[#25D366]" />
        </a>
      </div>
      <div class="mt-4 text-center sm:text-left">
        <a href="faq.html" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium text-sm transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Preguntas frecuentes
        </a>
      </div>
    </div>
  </div>
  <div class="max-w-4xl mx-auto mt-4 sm:mt-6 text-center text-gray-500 text-xs sm:text-sm font-inter">
    <p>Ubify es una plataforma digital para la publicación de propiedades en toda la zona. No realiza intermediación inmobiliaria ni cobra comisiones por operaciones. Las negociaciones son responsabilidad exclusiva de las partes intervinientes.</p>
  </div>
  <p class="text-center text-gray-500 mt-2 text-xs sm:text-sm font-inter">© 2025 Ubify - Diseñado y desarrollado por Hostara.</p>
</footer>

  <script src="app.js" type="module"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { toggleFavoriteProperty, isPropertyInFavorites, showToast } from "./app.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC0iRq9z-KJxjnX_4CpjEZrwvX0hjvPb1w",
      authDomain: "ubify-598fe.firebaseapp.com",
      projectId: "ubify-598fe",
      storageBucket: "ubify-598fe.appspot.com",
      messagingSenderId: "291570754705",
      appId: "1:291570754705:web:c458124db5954b58d34b30"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let properties = [];
    let favoriteProperties = [];

    function getCurrencySymbol(currency) {
      switch(currency) {
        case 'USD': return 'USD ';
        case 'EUR': return '€';
        default: return 'ARS $';
      }
    }

    function loadFavorites() {
      const stored = localStorage.getItem('favoriteProperties');
      return stored ? JSON.parse(stored) : [];
    }

    function saveFavorites(favorites) {
      localStorage.setItem('favoriteProperties', JSON.stringify(favorites));
    }

    function updateFavoritesCount() {
      // Recargar favoritos desde localStorage para obtener los datos más actuales
      favoriteProperties = loadFavorites();
      const count = favoriteProperties.length;
      
      // Actualizar contador en la barra de acciones
      const totalFavoritesElement = document.getElementById('totalFavorites');
      if (totalFavoritesElement) {
        totalFavoritesElement.textContent = count;
      }
      
      console.log('Favoritos actualizados:', favoriteProperties);
      console.log('Contador:', count);
      
      // Mostrar/ocultar botones de limpiar según si hay favoritos
      updateClearButtonsVisibility();
    }

    function showEmptyState() {
      document.getElementById('loadingState').classList.add('hidden');
      document.getElementById('favoritesGrid').classList.add('hidden');
      document.getElementById('actionsBar').classList.add('hidden');
      document.getElementById('emptyState').classList.remove('hidden');
    }

    function showFavoritesGrid() {
      document.getElementById('loadingState').classList.add('hidden');
      document.getElementById('emptyState').classList.add('hidden');
      document.getElementById('favoritesGrid').classList.remove('hidden');
      document.getElementById('actionsBar').classList.remove('hidden');
    }

    function updateClearButtonsVisibility() {
      const hasFavorites = favoriteProperties.length > 0;
      console.log('Actualizando visibilidad de botones. Tiene favoritos:', hasFavorites, 'Cantidad:', favoriteProperties.length);
      
      // Mostrar/ocultar botón de limpiar en la barra de acciones
      const clearBottomButton = document.getElementById('clearAllFavoritesBottom');
      if (clearBottomButton) {
        console.log('Botón de limpiar inferior encontrado');
        if (hasFavorites) {
          clearBottomButton.classList.remove('hidden');
          clearBottomButton.disabled = false;
          console.log('Botón inferior mostrado');
        } else {
          clearBottomButton.classList.add('hidden');
          clearBottomButton.disabled = true;
          console.log('Botón inferior ocultado');
        }
      } else {
        console.log('Botón de limpiar inferior NO encontrado');
      }
    }

    function renderFavorites() {
      const favoritesGrid = document.getElementById('favoritesGrid');
      favoritesGrid.innerHTML = '';

      if (favoriteProperties.length === 0) {
        showEmptyState();
        return;
      }

      const propertiesToShow = properties.filter(p => favoriteProperties.includes(p.id));
      
      if (propertiesToShow.length === 0) {
        showEmptyState();
        return;
      }

      propertiesToShow.forEach(property => {
        const card = document.createElement('div');
        card.className = 'property-card group cursor-pointer animate-fade-in';
        card.innerHTML = `
          <div class="card-image relative overflow-hidden">
            <img src="${property.images?.[0] || 'https://via.placeholder.com/300x200'}"
                 alt="${property.title}"
                 class="w-full h-full object-cover transition duration-500 group-hover:scale-105"
                 loading="lazy">
            <button class="favorite-btn favorited absolute top-3 right-3"
                    data-property-id="${property.id}"
                    aria-label="Remover de favoritos">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
              </svg>
            </button>
            ${property.featured ? '<div class="absolute top-3 left-3 bg-gradient-to-r from-yellow-400 to-yellow-500 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg">⭐ Destacada</div>' : ''}
          </div>
          <div class="card-content">
            <div class="card-body">
              <h4 class="text-lg font-montserrat font-semibold text-gray-800 mb-3 line-clamp-2 group-hover:text-blue-600 transition-colors">${property.title}</h4>
              <div class="flex flex-wrap gap-2 mb-3">
                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-medium">${property.type}</span>
                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-medium">${property.operation}</span>
                ${property.location ? `<span class="bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-xs font-medium">${property.location}</span>` : ''}
              </div>
              <p class="text-xl font-bold text-gray-900 mb-3">${getCurrencySymbol(property.currency)}${property.price ? property.price.toLocaleString() : 'Consultar'}</p>
              <p class="text-gray-500 text-sm line-clamp-2 mb-4">${property.description || 'Sin descripción disponible'}</p>
              <div class="flex gap-3 text-sm text-gray-600 mb-4">
                ${property.bedrooms ? `<span class="flex items-center bg-gray-50 px-2 py-1 rounded-md"><svg class="w-4 h-4 mr-1 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>${property.bedrooms}</span>` : ''}
                ${property.bathrooms ? `<span class="flex items-center bg-gray-50 px-2 py-1 rounded-md"><svg class="w-4 h-4 mr-1 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 4a3 3 0 00-3 3v6a3 3 0 003 3h10a3 3 0 003-3V7a3 3 0 00-3-3H5zm-1 9v-6a1 1 0 011-1h10a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>${property.bathrooms}</span>` : ''}
                ${property.squareMeters ? `<span class="flex items-center bg-gray-50 px-2 py-1 rounded-md"><svg class="w-4 h-4 mr-1 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v12a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm2 1v10h10V5H5z" clip-rule="evenodd"></path></svg>${property.squareMeters}m²</span>` : ''}
              </div>
            </div>
            <div class="card-footer">
              <div class="flex gap-2">
                <a href="property-details.html?slug=${property.slug}" class="flex-1 bg-gradient-to-r from-blue-600 to-purple-700 text-white py-3 rounded-lg font-semibold text-sm hover:from-blue-700 hover:to-purple-800 transition duration-300 text-center">
                  Ver detalles
                </a>
                <button class="favorite-btn favorited p-3 hover:bg-red-50 rounded-lg transition"
                        data-property-id="${property.id}"
                        aria-label="Remover de favoritos">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                  </svg>
                </button>
              </div>
            </div>
          </div>`;
        
        favoritesGrid.appendChild(card);
        
        // Event listeners para los botones de favorito
        const favoriteButtons = card.querySelectorAll('.favorite-btn');
        favoriteButtons.forEach(button => {
          button.addEventListener('click', (e) => {
            e.stopPropagation();
            removeFromFavorites(property.id);
          });
        });
      });

      showFavoritesGrid();
    }

    function removeFromFavorites(propertyId) {
      const index = favoriteProperties.indexOf(propertyId);
      if (index > -1) {
        favoriteProperties.splice(index, 1);
        saveFavorites(favoriteProperties);
        updateFavoritesCount();
        renderFavorites();
        showToast('Propiedad removida de favoritos', 'info');
      }
    }

    function clearAllFavorites() {
      console.log('Intentando limpiar favoritos. Favoritos actuales:', favoriteProperties);
      
      if (favoriteProperties.length === 0) {
        console.log('No hay favoritos para limpiar');
        showToast('No hay favoritos para limpiar', 'info');
        return;
      }
      
      console.log('Limpiando favoritos...');
      favoriteProperties = [];
      saveFavorites(favoriteProperties);
      updateFavoritesCount();
      renderFavorites();
      showToast('Todos los favoritos han sido eliminados', 'info');
      console.log('Favoritos limpiados exitosamente');
    }

    async function loadProperties() {
      try {
        const querySnapshot = await getDocs(collection(db, "propiedades"));
        properties = querySnapshot.docs.map(doc => ({
          id: doc.id,
          ...doc.data()
        }));
        
        favoriteProperties = loadFavorites();
        updateFavoritesCount();
        renderFavorites();
        
        // Mostrar el footer después de cargar los favoritos
        const mainFooter = document.getElementById('mainFooter');
        if (mainFooter) {
          mainFooter.classList.remove('hidden');
        }
      } catch (error) {
        console.error("Error al cargar propiedades:", error);
        showToast('Error al cargar las propiedades', 'error');
        
        // Mostrar el footer incluso si hay error
        const mainFooter = document.getElementById('mainFooter');
        if (mainFooter) {
          mainFooter.classList.remove('hidden');
        }
      }
    }

    // Event listeners
    document.getElementById('clearAllFavoritesBottom')?.addEventListener('click', clearAllFavorites);
    

    // Cargar datos al iniciar
    document.addEventListener('DOMContentLoaded', () => {
      loadProperties();
    });

    // Escuchar cambios en localStorage desde otras pestañas
    window.addEventListener('storage', (e) => {
      if (e.key === 'favoriteProperties') {
        updateFavoritesCount();
        renderFavorites();
      }
    });

    // Escuchar eventos personalizados de favoritos
    window.addEventListener('favoritesUpdated', () => {
      updateFavoritesCount();
      renderFavorites();
    });
  </script>
</body>
</html>

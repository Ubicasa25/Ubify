<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mis Favoritos | Ubify</title>
  <meta name="description" content="Revisa tus propiedades favoritas en Ubify. Contacta directamente con los propietarios." />
  <meta name="keywords" content="favoritos, propiedades guardadas, Villa Ángela, inmobiliaria" />
  <link rel="icon" type="image/png" href="logo-negro-sinfondo-pestaña.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&display=swap" rel="stylesheet" />
  <style>
    body { 
      font-family: 'Montserrat', sans-serif; 
      background-color: #f8fafc;
      color: #1f2937; 
    }
    h1, h2, h3, h4, .font-playfair {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      color: #1f2937;
    }
    .font-inter {
      font-family: 'Inter', sans-serif;
    }
    .property-card {
      background: linear-gradient(145deg, #ffffff, #f8fafc);
      border: 1px solid #e2e8f0;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: all 0.3s ease;
      border-radius: 1rem;
      overflow: hidden;
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    .property-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
    }
    .property-card .card-image {
      height: 200px;
      overflow: hidden;
    }
    .property-card .card-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 1.25rem;
    }
    .property-card .card-content .card-body {
      flex: 1;
    }
    .property-card .card-content .card-footer {
      margin-top: auto;
    }
    .favorite-btn {
      background-color: white;
      border-radius: 50%;
      width: 2.5rem;
      height: 2.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: all 0.2s;
      border: none;
      cursor: pointer;
    }
    .favorite-btn:hover {
      background-color: #f0f0f0;
      transform: scale(1.1);
    }
    .favorite-btn.favorited {
      background-color: #ef4444;
    }
    .favorite-btn.favorited svg {
      fill: white;
      stroke: white;
    }
    .favorite-btn svg {
      width: 1.2rem;
      height: 1.2rem;
      stroke: #4b5563;
      fill: none;
    }
    .btn-primary {
      background-image: linear-gradient(to right, #2563eb, #1d4ed8);
      color: #ffffff;
      transition: background 0.3s ease;
    }
    .btn-primary:hover {
      background-image: linear-gradient(to right, #1d4ed8, #1e40af);
    }
    .btn-secondary {
      background-color: #10b981;
      color: #ffffff;
    }
    .btn-secondary:hover {
      background-color: #059669;
    }
    .btn-tertiary {
      background-color: #ffffff;
      color: #2563eb;
      border: 2px solid #2563eb;
      transition: all 0.3s ease;
    }
    .btn-tertiary:hover {
      background-color: #f0f5ff;
      transform: translateY(-2px);
    }
    .animate-fade-in {
      animation: fadeIn 1s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .animate-slide-up {
      animation: slideUp 0.3s ease-in-out;
    }
    .animate-slide-down {
      animation: slideDown 0.3s ease-in-out;
    }
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes slideDown {
      from { transform: translateY(0); opacity: 1; }
      to { transform: translateY(20px); opacity: 0; }
    }
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: #6b7280;
    }
    .empty-state svg {
      margin: 0 auto 1rem;
      color: #d1d5db;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 font-inter">
  <!-- Header -->
  <header class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <a href="index.html" class="btn-tertiary px-4 py-2 rounded-full font-semibold text-sm font-montserrat flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" />
            </svg>
            Volver al inicio
          </a>
          <div class="flex items-center">
            <img src="logo-negro-sinfondo.png" alt="Ubify" class="h-8 w-auto mr-3" />
            <h1 class="text-xl font-montserrat font-bold text-gray-800">Mis Favoritos</h1>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <span id="favoritesCount" class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">0 propiedades</span>
          <button id="clearAllFavorites" class="text-red-600 hover:text-red-800 font-medium text-sm transition-colors">
            Limpiar todo
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="py-8 px-4">
    <div class="max-w-7xl mx-auto">
      <!-- Loading State -->
      <div id="loadingState" class="text-center py-12">
        <div class="inline-flex items-center px-4 py-2 bg-blue-100 text-blue-800 rounded-lg">
          <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-800" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Cargando tus favoritos...
        </div>
      </div>

      <!-- Empty State -->
      <div id="emptyState" class="empty-state hidden">
        <svg class="h-24 w-24 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
        </svg>
        <h2 class="text-2xl font-montserrat font-semibold text-gray-900 mb-2">No guardaste en favoritos ninguna propiedad.</h2>
        <p class="text-gray-500 mb-6">Explora las propiedades y marca las que te gusten con el corazón</p>
        <a href="index.html" class="btn-primary px-6 py-3 rounded-full font-semibold text-base font-montserrat inline-flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          Explorar propiedades
        </a>
      </div>

      <!-- Favorites Grid -->
      <div id="favoritesGrid" class="grid gap-6 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 hidden">
        <!-- Las propiedades se insertarán aquí -->
      </div>

      <!-- Actions Bar -->
      <div id="actionsBar" class="mt-8 bg-white rounded-xl shadow-sm border border-gray-200 p-6 hidden">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
          <div class="text-sm text-gray-600">
            <span id="totalFavorites">0</span> propiedades guardadas
          </div>
          <div class="flex flex-col sm:flex-row gap-3">
            <button id="shareFavorites" class="btn-tertiary px-4 py-2 rounded-lg font-medium text-sm flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" />
              </svg>
              Compartir lista
            </button>
            <button id="clearAllFavoritesBottom" class="bg-red-100 text-red-700 hover:bg-red-200 px-4 py-2 rounded-lg font-medium text-sm flex items-center justify-center transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
              Limpiar todo
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-100 py-8 px-4 border-t border-gray-200 mt-16">
    <div class="max-w-6xl mx-auto grid grid-cols-1 gap-8 sm:grid-cols-3 text-center sm:text-left">
      <div class="border-b sm:border-b-0 sm:border-r border-gray-300 pb-6 sm:pb-0 sm:pr-6">
        <h3 class="text-lg sm:text-xl font-montserrat font-semibold mb-4 text-gray-800">Ubify</h3>
        <p class="text-gray-600 text-sm sm:text-base font-inter">Propiedades en toda la zona. Encontrá tu espacio o publicá el tuyo.</p>
      </div>
      <div class="border-b sm:border-b-0 sm:border-r border-gray-300 pb-6 sm:pb-0 sm:pr-6">
        <h3 class="text-lg sm:text-xl font-montserrat font-semibold mb-4 text-gray-800">Contáctanos</h3>
        <p class="text-gray-600 text-sm sm:text-base font-inter mb-2">¿Querés publicar una propiedad?</p>
        <a href="https://wa.me/+543735308294?text=Hola,%20quiero%20publicar%20una%20propiedad%20en%20Ubify" target="_blank" class="inline-flex items-center justify-center bg-green-500 text-white px-4 py-2 rounded-lg font-semibold text-sm sm:text-base hover:bg-green-600 transition duration-300 font-inter">
          <img src="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/whatsapp.svg" alt="WhatsApp" class="w-5 h-5 mr-2 invert" />
          Quiero publicar
        </a>
      </div>
      <div>
        <h3 class="text-lg sm:text-xl font-montserrat font-semibold mb-4 text-gray-800">¡Seguinos!</h3>
        <div class="flex justify-center sm:justify-start space-x-6">
          <a href="https://www.instagram.com/" target="_blank" class="hover:scale-110 transition-transform">
            <img src="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/instagram.svg" alt="Instagram" class="w-6 h-6 text-[#E4405F]" />
          </a>
        </div>
      </div>
    </div>
    <div class="max-w-4xl mx-auto mt-6 text-center text-gray-500 text-xs sm:text-sm font-inter">
      <p>Ubify es una plataforma digital para la publicación de propiedades en toda la zona. No realiza intermediación inmobiliaria ni cobra comisiones por operaciones. Las negociaciones son responsabilidad exclusiva de las partes intervinientes.</p>
    </div>
    <p class="text-center text-gray-500 mt-2 text-xs sm:text-sm font-inter">© 2025 Ubify - Diseñado y desarrollado por Hostara.</p>
  </footer>

  <script src="app.js" type="module"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { toggleFavoriteProperty, isPropertyInFavorites, showToast } from "./app.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC0iRq9z-KJxjnX_4CpjEZrwvX0hjvPb1w",
      authDomain: "ubify-598fe.firebaseapp.com",
      projectId: "ubify-598fe",
      storageBucket: "ubify-598fe.appspot.com",
      messagingSenderId: "291570754705",
      appId: "1:291570754705:web:c458124db5954b58d34b30"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let properties = [];
    let favoriteProperties = [];

    function getCurrencySymbol(currency) {
      switch(currency) {
        case 'USD': return 'USD ';
        case 'EUR': return '€';
        default: return 'ARS $';
      }
    }

    function loadFavorites() {
      const stored = localStorage.getItem('favoriteProperties');
      return stored ? JSON.parse(stored) : [];
    }

    function saveFavorites(favorites) {
      localStorage.setItem('favoriteProperties', JSON.stringify(favorites));
    }

    function updateFavoritesCount() {
      const count = favoriteProperties.length;
      document.getElementById('favoritesCount').textContent = `${count} ${count === 1 ? 'propiedad' : 'propiedades'}`;
      document.getElementById('totalFavorites').textContent = count;
    }

    function showEmptyState() {
      document.getElementById('loadingState').classList.add('hidden');
      document.getElementById('favoritesGrid').classList.add('hidden');
      document.getElementById('actionsBar').classList.add('hidden');
      document.getElementById('emptyState').classList.remove('hidden');
    }

    function showFavoritesGrid() {
      document.getElementById('loadingState').classList.add('hidden');
      document.getElementById('emptyState').classList.add('hidden');
      document.getElementById('favoritesGrid').classList.remove('hidden');
      document.getElementById('actionsBar').classList.remove('hidden');
    }

    function renderFavorites() {
      const favoritesGrid = document.getElementById('favoritesGrid');
      favoritesGrid.innerHTML = '';

      if (favoriteProperties.length === 0) {
        showEmptyState();
        return;
      }

      const propertiesToShow = properties.filter(p => favoriteProperties.includes(p.id));
      
      if (propertiesToShow.length === 0) {
        showEmptyState();
        return;
      }

      propertiesToShow.forEach(property => {
        const card = document.createElement('div');
        card.className = 'property-card group cursor-pointer animate-fade-in';
        card.innerHTML = `
          <div class="card-image relative overflow-hidden">
            <img src="${property.images?.[0] || 'https://via.placeholder.com/300x200'}"
                 alt="${property.title}"
                 class="w-full h-full object-cover transition duration-500 group-hover:scale-105"
                 loading="lazy">
            <button class="favorite-btn favorited absolute top-3 right-3"
                    data-property-id="${property.id}"
                    aria-label="Remover de favoritos">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
              </svg>
            </button>
            ${property.featured ? '<div class="absolute top-3 left-3 bg-gradient-to-r from-yellow-400 to-yellow-500 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg">⭐ Destacada</div>' : ''}
          </div>
          <div class="card-content">
            <div class="card-body">
              <h4 class="text-lg font-montserrat font-semibold text-gray-800 mb-3 line-clamp-2 group-hover:text-blue-600 transition-colors">${property.title}</h4>
              <div class="flex flex-wrap gap-2 mb-3">
                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-medium">${property.type}</span>
                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-medium">${property.operation}</span>
                ${property.location ? `<span class="bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-xs font-medium">${property.location}</span>` : ''}
              </div>
              <p class="text-xl font-bold text-gray-900 mb-3">${getCurrencySymbol(property.currency)}${property.price ? property.price.toLocaleString() : 'Consultar'}</p>
              <p class="text-gray-500 text-sm line-clamp-2 mb-4">${property.description || 'Sin descripción disponible'}</p>
              <div class="flex gap-3 text-sm text-gray-600 mb-4">
                ${property.bedrooms ? `<span class="flex items-center bg-gray-50 px-2 py-1 rounded-md"><svg class="w-4 h-4 mr-1 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>${property.bedrooms}</span>` : ''}
                ${property.bathrooms ? `<span class="flex items-center bg-gray-50 px-2 py-1 rounded-md"><svg class="w-4 h-4 mr-1 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 4a3 3 0 00-3 3v6a3 3 0 003 3h10a3 3 0 003-3V7a3 3 0 00-3-3H5zm-1 9v-6a1 1 0 011-1h10a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>${property.bathrooms}</span>` : ''}
                ${property.squareMeters ? `<span class="flex items-center bg-gray-50 px-2 py-1 rounded-md"><svg class="w-4 h-4 mr-1 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v12a1 1 0 01-1 1H4a1 1 0 01-1-1V4zm2 1v10h10V5H5z" clip-rule="evenodd"></path></svg>${property.squareMeters}m²</span>` : ''}
              </div>
            </div>
            <div class="card-footer">
              <div class="flex gap-2">
                <a href="property-details.html?slug=${property.slug}" class="flex-1 bg-gradient-to-r from-blue-600 to-purple-700 text-white py-3 rounded-lg font-semibold text-sm hover:from-blue-700 hover:to-purple-800 transition duration-300 text-center">
                  Ver detalles
                </a>
                <button class="favorite-btn favorited p-3 hover:bg-red-50 rounded-lg transition"
                        data-property-id="${property.id}"
                        aria-label="Remover de favoritos">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                  </svg>
                </button>
              </div>
            </div>
          </div>`;
        
        favoritesGrid.appendChild(card);
        
        // Event listeners para los botones de favorito
        const favoriteButtons = card.querySelectorAll('.favorite-btn');
        favoriteButtons.forEach(button => {
          button.addEventListener('click', (e) => {
            e.stopPropagation();
            removeFromFavorites(property.id);
          });
        });
      });

      showFavoritesGrid();
    }

    function removeFromFavorites(propertyId) {
      const index = favoriteProperties.indexOf(propertyId);
      if (index > -1) {
        favoriteProperties.splice(index, 1);
        saveFavorites(favoriteProperties);
        updateFavoritesCount();
        renderFavorites();
        showToast('Propiedad removida de favoritos', 'info');
      }
    }

    function clearAllFavorites() {
      favoriteProperties = [];
      saveFavorites(favoriteProperties);
      updateFavoritesCount();
      renderFavorites();
      showToast('Todos los favoritos han sido eliminados', 'info');
    }

    async function loadProperties() {
      try {
        const querySnapshot = await getDocs(collection(db, "propiedades"));
        properties = querySnapshot.docs.map(doc => ({
          id: doc.id,
          ...doc.data()
        }));
        
        favoriteProperties = loadFavorites();
        updateFavoritesCount();
        renderFavorites();
      } catch (error) {
        console.error("Error al cargar propiedades:", error);
        showToast('Error al cargar las propiedades', 'error');
      }
    }

    // Event listeners
    document.getElementById('clearAllFavorites')?.addEventListener('click', clearAllFavorites);
    document.getElementById('clearAllFavoritesBottom')?.addEventListener('click', clearAllFavorites);
    
    document.getElementById('shareFavorites')?.addEventListener('click', () => {
      if (navigator.share) {
        navigator.share({
          title: 'Mis propiedades favoritas en Ubify',
          text: `He guardado ${favoriteProperties.length} propiedades en Ubify`,
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(window.location.href);
        showToast('¡Enlace copiado al portapapeles!', 'success');
      }
    });

    // Cargar datos al iniciar
    document.addEventListener('DOMContentLoaded', () => {
      loadProperties();
    });
  </script>
</body>
</html>

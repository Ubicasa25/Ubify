<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detalles de la Propiedad | Ubify</title>
  <meta name="description" content="Descripción detallada de la propiedad en Villa Ángela, Chaco. Contacta al propietario directamente." />
  <meta name="keywords" content="alquiler Villa Ángela, casas en venta Villa Ángela, propiedades Villa Ángela, inmobiliarias" />
  <link rel="icon" type="image/png" href="logo-negro-sinfondo-pestaña.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&display=swap" rel="stylesheet" />
  <style>
    body { 
      font-family: 'Montserrat', sans-serif; 
      background-color: #e5e7eb;
      color: #1f2937; 
    }
    h1, h2, h3, h4, .font-playfair {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      color: #1f2937;
    }
    .font-inter {
      font-family: 'Inter', sans-serif;
    }
    .text-shadow-subtle {
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }
    .property-card {
      background-color: #eff6ff;
      border: 1px solid #d1d5db;
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: all 0.3s ease;
      cursor: pointer;
      padding: 1.5rem;
      min-height: 140px;
      position: relative;
      overflow: hidden;
    }
    .property-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    .property-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .property-card:hover::before {
      opacity: 1;
    }
    .thumbnail {
      width: 80px;
      height: 60px;
      object-fit: cover;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }
    .thumbnail:hover {
      transform: scale(1.05);
      box-shadow: 0 0 0 2px #2563eb;
      border-color: #2563eb;
    }
    .thumbnail.active {
      box-shadow: 0 0 0 2px #2563eb;
      border-color: #2563eb;
      transform: scale(1.02);
    }
    .carousel-image { 
      transition: opacity 0.5s ease-in-out;
      cursor: pointer;
    }
    .btn-primary {
      background-image: linear-gradient(to right, #2563eb, #1d4ed8);
      color: #ffffff;
      transition: background 0.3s ease;
    }
    .btn-primary:hover {
      background-image: linear-gradient(to right, #1d4ed8, #1e40af);
    }
    .btn-secondary {
      background-color: #10b981;
      color: #ffffff;
    }
    .btn-secondary:hover {
      background-color: #059669;
    }
    .btn-tertiary {
      background-color: #ffffff;
      color: #2563eb;
      border: 2px solid #2563eb;
      transition: all 0.3s ease;
    }
    .btn-tertiary:hover {
      background-color: #f0f5ff;
      transform: translateY(-2px);
    }
    .header-divider {
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(0, 0, 0, 0.1), transparent);
    }
    @keyframes slide-in {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slide-out {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(20px); }
    }
    .animate-slide-in {
      animation: slide-in 0.3s ease-out forwards;
    }
    .animate-slide-out {
      animation: slide-out 0.3s ease-in forwards;
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.8);
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
      border-radius: 0.5rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .close {
      position: absolute;
      top: 20px;
      right: 30px;
      color: #fff;
      font-size: 30px;
      font-weight: bold;
      cursor: pointer;
      transition: color 0.3s;
    }
    .close:hover {
      color: #bbb;
    }
    .favorite-btn {
      background-color: white;
      border-radius: 50%;
      width: 2rem;
      height: 2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: all 0.2s;
      border: none;
      cursor: pointer;
    }
    .favorite-btn:hover {
      background-color: #f0f0f0;
      transform: scale(1.1);
    }
    .favorite-btn.favorited {
      background-color: #ef4444;
    }
    .favorite-btn.favorited svg {
      fill: white;
      stroke: white;
    }
    .favorite-btn svg {
      width: 1.2rem;
      height: 1.2rem;
      stroke: #4b5563;
      fill: none;
    }
    @media (max-width: 640px) {
      .favorite-btn {
        width: 1.8rem;
        height: 1.8rem;
      }
      .property-card {
        padding: 1rem;
        min-height: 100px;
      }
      .thumbnail {
        width: 60px;
        height: 45px;
      }
    }
    
    /* Mejoras para el header sticky */
    .sticky-header {
      backdrop-filter: blur(10px);
      background-color: rgba(255, 255, 255, 0.95);
    }
    
    /* Mejoras para botones en móvil */
    @media (max-width: 640px) {
      .btn-tertiary {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
      }
    }
    
    /* Mejoras para el formato de descripciones */
    .description-text {
      white-space: pre-line;
      word-wrap: break-word;
      line-height: 1.6;
    }
    
    /* Mejor espaciado para párrafos en descripciones */
    .description-text p {
      margin-bottom: 1rem;
    }
    
    .description-text p:last-child {
      margin-bottom: 0;
    }
    .animate-ping {
      animation: ping 0.5s cubic-bezier(0, 0, 0.2, 1);
    }
    @keyframes ping {
      75%, 100% {
        transform: scale(1.2);
        opacity: 0.8;
      }
    }
    .animate-slide-up {
      animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .animate-slide-down {
      animation: slideDown 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    @keyframes slideUp {
      from { 
        transform: translateY(100%); 
        opacity: 0; 
      }
      to { 
        transform: translateY(0); 
        opacity: 1; 
      }
    }
    @keyframes slideDown {
      from { 
        transform: translateY(0); 
        opacity: 1; 
      }
      to { 
        transform: translateY(100%); 
        opacity: 0; 
      }
    }
    
    /* Mejoras para móviles */
    @media (max-width: 640px) {
      .toast-notification {
        border-radius: 0.75rem;
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
      }
    }
    .loading-message {
      text-align: center;
      padding: 0;
      color: #4b5563;
      font-size: 1.2rem;
    }
    .error-message {
      text-align: center;
      padding: 3rem 2rem;
      background: linear-gradient(135deg, #fef2f2 0%, #fce7f3 100%);
      border-radius: 1rem;
      margin: 2rem 1rem;
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
      border: 1px solid #fecaca;
    }
    
    .error-icon {
      width: 4rem;
      height: 4rem;
      margin: 0 auto 1.5rem;
      background: linear-gradient(135deg, #f87171 0%, #ec4899 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .error-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #dc2626;
      margin-bottom: 0.5rem;
      font-family: 'Montserrat', sans-serif;
    }
    
    .error-description {
      font-size: 1rem;
      color: #6b7280;
      margin-bottom: 2rem;
      line-height: 1.6;
    }
    
    .error-actions {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      align-items: center;
    }
    
    .error-btn {
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      padding: 0.75rem 2rem;
      border-radius: 0.75rem;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 14px 0 rgba(59, 130, 246, 0.4);
    }
    
    .error-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px 0 rgba(59, 130, 246, 0.6);
    }
    
    @media (min-width: 640px) {
      .error-actions {
        flex-direction: row;
        justify-content: center;
      }
    }
    
  </style>
</head>
<body class="bg-gray-100 text-gray-800 font-inter">
  <header class="bg-gradient-to-r from-white via-gray-50 to-blue-50 shadow-lg relative z-50">
    <div class="max-w-6xl mx-auto px-3 sm:px-6 lg:px-8">
      <!-- Mobile Layout -->
      <div class="block sm:hidden">
        <div class="flex items-center justify-between py-3">
          <a href="index.html" class="flex items-center bg-white/80 backdrop-blur-sm text-gray-700 hover:text-blue-600 hover:bg-blue-50 px-4 py-2 rounded-xl font-medium text-sm transition-all duration-300 shadow-sm hover:shadow-md">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" />
            </svg>
            Volver al inicio
          </a>
          <div class="flex items-center space-x-3">
            <button id="favoriteButtonMobile" class="favorite-btn relative group" data-property-id="" aria-label="Añadir a favoritos">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
              </svg>
              <span class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
                Agregar a favoritos
              </span>
            </button>
            <a href="favorites.html" class="text-blue-600 hover:text-blue-800 transition-colors bg-blue-50 hover:bg-blue-100 px-3 py-2 rounded-lg font-medium text-sm">
              Ver favoritos
            </a>
          </div>
        </div>
        <div class="pb-4 border-b border-gray-200">
          <h1 id="modalTitleMobile" class="text-lg font-montserrat font-semibold text-gray-800 mb-2 text-shadow-subtle leading-tight"></h1>
          <p id="modalPriceMobile" class="text-lg font-bold text-blue-600 mb-3 font-montserrat">
            <span id="modalCurrencyMobile"></span> <span id="modalPriceValueMobile"></span>
          </p>
          <div class="flex flex-wrap gap-2">
            <span id="modalTypeBadgeMobile" class="bg-blue-600 text-white px-3 py-1 rounded-full text-xs font-inter"></span>
            <span id="modalOperationBadgeMobile" class="bg-purple-600 text-white px-3 py-1 rounded-full text-xs font-inter"></span>
            <span id="modalLocationBadgeMobile" class="bg-gray-600 text-white px-3 py-1 rounded-full text-xs font-inter"></span>
          </div>
        </div>
      </div>

      <!-- Desktop Layout -->
      <div class="hidden sm:block">
        <div class="flex items-center justify-between py-4">
          <a href="index.html" class="bg-white/80 backdrop-blur-sm text-gray-700 hover:text-blue-600 hover:bg-blue-50 px-6 py-3 rounded-xl font-semibold text-sm font-montserrat flex items-center transition-all duration-300 shadow-sm hover:shadow-md">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd" />
            </svg>
            Volver al inicio
          </a>
          
          <div class="flex-1 flex flex-col items-center text-center px-6">
            <h1 id="modalTitle" class="text-xl lg:text-2xl font-montserrat font-semibold text-gray-800 mb-2 text-shadow-subtle"></h1>
            <p id="modalPrice" class="text-lg lg:text-xl font-bold text-blue-600 mb-3 font-montserrat">
              <span id="modalCurrency"></span> <span id="modalPriceValue"></span>
            </p>
            <div class="flex justify-center gap-2 flex-wrap">
              <span id="modalTypeBadge" class="bg-blue-600 text-white px-3 py-1 rounded-full text-xs font-inter"></span>
              <span id="modalOperationBadge" class="bg-purple-600 text-white px-3 py-1 rounded-full text-xs font-inter"></span>
              <span id="modalLocationBadge" class="bg-gray-600 text-white px-3 py-1 rounded-full text-xs font-inter"></span>
            </div>
          </div>
          
          <div class="flex items-center space-x-4">
            <a href="favorites.html" class="text-blue-600 hover:text-blue-800 font-medium text-sm flex items-center transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
              </svg>
              Ver favoritos
            </a>
            <button id="favoriteButton" class="favorite-btn" data-property-id="" aria-label="Añadir a favoritos">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>
  <main id="mainContent" class="py-6 sm:py-12 px-3 sm:px-4 bg-gray-100">
    <div class="max-w-6xl mx-auto">
      <div id="loadingMessage" class="loading-message">
        <div class="text-center py-16">
          <div class="inline-flex flex-col items-center space-y-4">
            <div class="relative">
              <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>
              <div class="absolute inset-0 flex items-center justify-center">
                <svg class="w-6 h-6 text-blue-600" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                </svg>
              </div>
            </div>
            <div class="text-center">
              <h3 class="text-lg font-montserrat font-semibold text-gray-800 mb-2">Cargando detalles de la propiedad</h3>
              <p class="text-gray-500 text-sm">Un momento, estamos preparando toda la información...</p>
            </div>
          </div>
        </div>
      </div>
      <div id="errorMessage" class="error-message hidden"></div>
      <div id="propertyDetails" class="hidden">
        <div class="relative rounded-xl overflow-hidden shadow-xl mb-4 sm:mb-6">
          <img id="mainImage" src="" alt="Imagen principal" class="w-full h-48 sm:h-64 md:h-96 lg:h-[500px] object-cover carousel-image">
          <button onclick="prevImage()" class="absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 bg-gray-800 bg-opacity-70 text-white p-2 sm:p-3 rounded-full hover:bg-gray-700 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <button onclick="nextImage()" class="absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 bg-gray-800 bg-opacity-70 text-white p-2 sm:p-3 rounded-full hover:bg-gray-700 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>
        <div id="thumbnailContainer" class="flex justify-start gap-2 sm:gap-3 mt-3 sm:mt-4 overflow-x-auto pb-3 sm:pb-4 px-1"></div>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mt-6 sm:mt-8">
          <div class="property-card bg-gradient-to-br from-blue-50 to-indigo-100 border-blue-200 hover:shadow-blue-200/50">
            <div class="flex flex-col items-center text-center">
              <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center mb-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </div>
              <h3 class="text-sm text-gray-600 font-inter mb-1">Ubicación</h3>
              <p id="modalLocation" class="text-base font-semibold text-gray-800 font-montserrat"></p>
            </div>
          </div>
          
          <div class="property-card bg-gradient-to-br from-green-50 to-emerald-100 border-green-200 hover:shadow-green-200/50">
            <div class="flex flex-col items-center text-center">
              <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center mb-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                </svg>
              </div>
              <h3 class="text-sm text-gray-600 font-inter mb-1">Metros cuadrados</h3>
              <p id="modalSquareMeters" class="text-base font-semibold text-gray-800 font-montserrat"></p>
            </div>
          </div>
          
          <div class="property-card bg-gradient-to-br from-purple-50 to-violet-100 border-purple-200 hover:shadow-purple-200/50">
            <div class="flex flex-col items-center text-center">
              <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center mb-3">
                <span class="text-2xl">🛏️</span>
              </div>
              <h3 class="text-sm text-gray-600 font-inter mb-1">Dormitorio/s</h3>
              <p id="modalBedrooms" class="text-base font-semibold text-gray-800 font-montserrat"></p>
            </div>
          </div>
          
          <div class="property-card bg-gradient-to-br from-orange-50 to-amber-100 border-orange-200 hover:shadow-orange-200/50">
            <div class="flex flex-col items-center text-center">
              <div class="w-12 h-12 bg-orange-500 rounded-full flex items-center justify-center mb-3">
                <span class="text-2xl">🚿</span>
              </div>
              <h3 class="text-sm text-gray-600 font-inter mb-1">Baño/s</h3>
              <p id="modalBathrooms" class="text-base font-semibold text-gray-800 font-montserrat"></p>
            </div>
          </div>
        </div>
        
        <!-- Sección del Mapa -->
        <div class="mt-8 sm:mt-10 border rounded-xl overflow-hidden shadow bg-white">
          <div class="bg-gradient-to-r from-gray-50 to-blue-50 px-4 sm:px-6 py-4 border-b border-gray-200">
            <div class="flex items-center">
              <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                </svg>
              </div>
              <div>
                <h3 class="text-lg font-montserrat font-semibold text-gray-800">Ubicación en el Mapa</h3>
                <p class="text-sm text-gray-600">Visualiza la ubicación exacta de la propiedad</p>
              </div>
            </div>
          </div>
          <div class="p-4 sm:p-6">
            <div id="propertyMap" class="w-full h-64 sm:h-80 bg-gray-200 rounded-lg flex items-center justify-center relative overflow-hidden">
              <div id="mapPlaceholder" class="text-center text-gray-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-3 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                </svg>
                <p class="text-sm">Mapa se cargará aquí</p>
                <p class="text-xs text-gray-400 mt-1">Se configurará desde el panel de administración</p>
              </div>
              
              <div id="mapLoading" class="text-center text-gray-500 hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-3 text-blue-400 animate-spin" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                <p class="text-sm">Cargando mapa...</p>
              </div>
              
              <div id="mapError" class="text-center text-gray-500 hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto mb-3 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z" />
                </svg>
                <p class="text-sm text-red-600">Error al cargar el mapa</p>
                <p class="text-xs text-gray-400 mt-1">Verifica que el enlace sea válido</p>
              </div>
              
              <iframe id="mapIframe" class="w-full h-full rounded-lg hidden" frameborder="0" style="border:0; width: 100%; height: 100%;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
            <div class="mt-4 text-center">
              <button id="openInMaps" class="inline-flex items-center bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium text-sm transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
                Abrir en Google Maps
              </button>
            </div>
          </div>
        </div>
        
        <div class="mt-8 sm:mt-10 border rounded-xl overflow-hidden shadow bg-white">
          <button onclick="window.toggleAccordion('desc')" class="w-full text-left px-4 sm:px-6 py-4 bg-blue-100 hover:bg-blue-200 font-semibold flex justify-between items-center text-base sm:text-lg lg:text-xl font-montserrat transition-colors">
            <span class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              Descripción
            </span>
            <span id="icon-desc" class="toggle-icon text-xl font-bold">+</span>
          </button>
          <div id="panel-desc" class="px-4 sm:px-6 py-4 hidden text-gray-700 font-inter">
            <div id="modalDescription" class="description-text text-base sm:text-lg"></div>
          </div>
        </div>
        <!-- Sección de Contacto Rediseñada -->
        <div class="mt-4 sm:mt-6 bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
          <!-- Header de Contacto -->
          <div class="bg-gradient-to-r from-green-50 to-blue-50 px-4 sm:px-6 py-4 border-b border-gray-200">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-blue-600 rounded-full flex items-center justify-center mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                  </svg>
                </div>
                <div>
                  <h3 class="text-lg font-montserrat font-semibold text-gray-800">Información de Contacto</h3>
                  <p class="text-sm text-gray-600">Propietario y datos de contacto</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Contenido de Contacto -->
          <div class="p-4 sm:p-6">
            <!-- Información del Propietario -->
            <div class="mb-6">
              <div class="flex items-center mb-3">
                <div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                </div>
                <div>
                  <p class="text-sm text-gray-500">Propietario</p>
                  <p id="modalOwner" class="text-base font-medium text-gray-800">
                    <span id="ownerName"></span>
                  </p>
                </div>
              </div>
              
              <div class="flex items-center">
                <div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                  </svg>
                </div>
                <div>
                  <p class="text-sm text-gray-500">Teléfono</p>
                  <p id="modalPhone" class="text-base font-medium text-gray-800">
                    <span id="phoneNumber"></span>
                  </p>
                </div>
              </div>
            </div>

            <!-- Botones de Acción -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <!-- WhatsApp -->
              <a id="modalWhatsApp" href="#" target="_blank" class="flex items-center justify-center bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg font-medium text-sm transition-colors">
                <img src="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/whatsapp.svg" alt="WhatsApp" class="w-4 h-4 mr-2 invert" />
                WhatsApp
              </a>
              
              <!-- Compartir -->
              <button id="copyLinkButton" class="flex items-center justify-center bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg font-medium text-sm transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" />
                </svg>
                Compartir
              </button>
            </div>
          </div>
        </div>
        <div id="imageModal" class="modal">
          <span class="close">×</span>
          <img class="modal-content" id="modalImage">
        </div>
      </div>
    </div>
  </main>
  <footer id="mainFooter" class="bg-gray-100 py-8 sm:py-10 px-3 sm:px-4 hidden">
    <div class="max-w-6xl mx-auto grid grid-cols-1 gap-6 sm:gap-8 sm:grid-cols-3 text-center sm:text-left">
      <div class="border-b sm:border-b-0 sm:border-r border-gray-300 pb-4 sm:pb-0 sm:pr-6">
        <h3 class="text-lg sm:text-xl font-montserrat font-semibold mb-3 sm:mb-4 text-gray-800">Ubify</h3>
        <p class="text-gray-600 text-sm sm:text-base font-inter">Propiedades en toda la zona. Encontrá tu espacio o publicá el tuyo.</p>
      </div>
      <div class="border-b sm:border-b-0 sm:border-r border-gray-300 pb-4 sm:pb-0 sm:pr-6">
        <h3 class="text-lg sm:text-xl font-montserrat font-semibold mb-3 sm:mb-4 text-gray-800">Contáctanos</h3>
        <p class="text-gray-600 text-sm sm:text-base font-inter mb-3">¿Querés publicar una propiedad?</p>
        <a href="https://wa.me/+543735308294?text=Hola,%20quiero%20publicar%20una%20propiedad%20en%20Ubify" target="_blank" class="inline-flex items-center justify-center bg-green-500 text-white px-4 py-2 rounded-lg font-semibold text-sm sm:text-base hover:bg-green-600 transition duration-300 font-inter w-full sm:w-auto">
          <img src="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/whatsapp.svg" alt="WhatsApp" class="w-4 h-4 sm:w-5 sm:h-5 mr-2 invert" />
          Quiero publicar
        </a>
      </div>
      <div>
        <h3 class="text-lg sm:text-xl font-montserrat font-semibold mb-3 sm:mb-4 text-gray-800">¡Seguinos!</h3>
        <div class="flex justify-center sm:justify-start space-x-6">
          <a href="https://www.facebook.com/" target="_blank" class="hover:scale-110 transition-transform">
            <img src="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/facebook.svg" alt="Facebook" class="w-5 h-5 sm:w-6 sm:h-6 text-[#1877F2]" />
          </a>
          <a href="https://www.instagram.com/" target="_blank" class="hover:scale-110 transition-transform">
            <img src="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/instagram.svg" alt="Instagram" class="w-5 h-5 sm:w-6 sm:h-6 text-[#E4405F]" />
          </a>
          <a href="https://wa.me/+543735308294?text=Hola,%20quiero%20más%20información%20sobre%20Ubify" target="_blank" class="hover:scale-110 transition-transform">
            <img src="https://cdn.jsdelivr.net/npm/simple-icons@v10/icons/whatsapp.svg" alt="WhatsApp" class="w-5 h-5 sm:w-6 sm:h-6 text-[#25D366]" />
          </a>
        </div>
        <div class="mt-4 text-center sm:text-left">
          <a href="faq.html" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium text-sm transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Preguntas frecuentes
          </a>
        </div>
      </div>
    </div>
    <div class="max-w-4xl mx-auto mt-4 sm:mt-6 text-center text-gray-500 text-xs sm:text-sm font-inter">
      <p>Ubify es una plataforma digital para la publicación de propiedades en toda la zona. No realiza intermediación inmobiliaria ni cobra comisiones por operaciones. Las negociaciones son responsabilidad exclusiva de las partes intervinientes.</p>
    </div>
    <p class="text-center text-gray-500 mt-2 text-xs sm:text-sm font-inter">© 2025 Ubify - Diseñado y desarrollado por Hostara.</p>
  </footer>
  <script src="app.js" type="module"></script>
  
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { toggleFavoriteProperty, isPropertyInFavorites, updateFavoritesCounter, showToast } from "./app.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC0iRq9z-KJxjnX_4CpjEZrwvX0hjvPb1w",
      authDomain: "ubify-598fe.firebaseapp.com",
      projectId: "ubify-598fe",
      storageBucket: "ubify-598fe.appspot.com",
      messagingSenderId: "291570754705",
      appId: "1:291570754705:web:c458124db5954b58d34b30"
    };

    console.log("Inicializando Firebase...");
    const app = initializeApp(firebaseConfig);
    console.log("Firebase inicializado:", app);
    const db = getFirestore(app);

    let propertyId = null;

    function showLoading(show) {
      const loadingMessage = document.getElementById('loadingMessage');
      const propertyDetails = document.getElementById('propertyDetails');
      const errorMessage = document.getElementById('errorMessage');
      if (loadingMessage && propertyDetails && errorMessage) {
        loadingMessage.classList.toggle('hidden', !show);
        propertyDetails.classList.toggle('hidden', show);
        errorMessage.classList.add('hidden');
      }
    }

    function showError(message) {
      const loadingMessage = document.getElementById('loadingMessage');
      const propertyDetails = document.getElementById('propertyDetails');
      const errorMessage = document.getElementById('errorMessage');
      const mainFooter = document.getElementById('mainFooter');
      
      if (loadingMessage && propertyDetails && errorMessage) {
        loadingMessage.classList.add('hidden');
        propertyDetails.classList.add('hidden');
        errorMessage.classList.remove('hidden');
        
        // Ocultar el footer cuando hay error
        if (mainFooter) {
          mainFooter.classList.add('hidden');
        }
        
        errorMessage.innerHTML = `
          <div class="error-icon">
            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z" />
            </svg>
          </div>
          <div class="error-title">¡Oops! Algo salió mal</div>
          <div class="error-description">${message}</div>
          <div class="error-actions">
            <a href="index.html" class="error-btn">Volver al inicio</a>
            <button onclick="window.location.reload()" class="error-btn" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); box-shadow: 0 4px 14px 0 rgba(107, 114, 128, 0.4);">Intentar de nuevo</button>
          </div>
        `;
      }
    }

    window.loadPropertyDetails = async function() {
      showLoading(true);
      const urlParams = new URLSearchParams(window.location.search);
      const slug = urlParams.get('slug');
      console.log("Slug recibido:", slug);

      if (!slug) {
        showError("Propiedad no encontrada. Por favor, verifica el enlace o regresa al inicio.");
        return;
      }

      try {
        console.log("Realizando consulta por slug:", slug);
        const q = query(collection(db, "propiedades"), where("slug", "==", slug));
        const querySnapshot = await getDocs(q);
        console.log("Resultados de la consulta:", querySnapshot.size, "documentos encontrados");

        if (!querySnapshot.empty) {
          const doc = querySnapshot.docs[0];
          propertyId = doc.id;
          const property = doc.data();
          console.log("Propiedad encontrada:", property);

          // Actualizar título en ambas versiones (móvil y desktop)
          const titleElement = document.getElementById('modalTitle');
          const titleElementMobile = document.getElementById('modalTitleMobile');
          if (titleElement) titleElement.textContent = property.title || "Sin título";
          if (titleElementMobile) titleElementMobile.textContent = property.title || "Sin título";

          // Actualizar precio en ambas versiones
          const priceElement = document.getElementById('modalPriceValue');
          const priceElementMobile = document.getElementById('modalPriceValueMobile');
          if (priceElement) priceElement.textContent = property.price ? property.price.toLocaleString() : "Consultar";
          if (priceElementMobile) priceElementMobile.textContent = property.price ? property.price.toLocaleString() : "Consultar";

          // Actualizar moneda en ambas versiones
          const currencyElement = document.getElementById('modalCurrency');
          const currencyElementMobile = document.getElementById('modalCurrencyMobile');
          let currencySymbol = 'ARS $';
          if (currencyElement) {
            switch(property.currency) {
              case 'USD': currencySymbol = 'USD '; currencyElement.textContent = 'USD '; break;
              case 'EUR': currencySymbol = '€'; currencyElement.textContent = '€'; break;
              default: currencySymbol = 'ARS $'; currencyElement.textContent = 'ARS $';
            }
          }
          if (currencyElementMobile) {
            switch(property.currency) {
              case 'USD': currencyElementMobile.textContent = 'USD '; break;
              case 'EUR': currencyElementMobile.textContent = '€'; break;
              default: currencyElementMobile.textContent = 'ARS $';
            }
          }

          // Actualizar badges en ambas versiones
          const typeBadge = document.getElementById('modalTypeBadge');
          const typeBadgeMobile = document.getElementById('modalTypeBadgeMobile');
          if (typeBadge) typeBadge.textContent = property.type ? property.type.charAt(0).toUpperCase() + property.type.slice(1) : "Sin tipo";
          if (typeBadgeMobile) typeBadgeMobile.textContent = property.type ? property.type.charAt(0).toUpperCase() + property.type.slice(1) : "Sin tipo";

          const operationBadge = document.getElementById('modalOperationBadge');
          const operationBadgeMobile = document.getElementById('modalOperationBadgeMobile');
          if (operationBadge) operationBadge.textContent = property.operation || 'Sin operación';
          if (operationBadgeMobile) operationBadgeMobile.textContent = property.operation || 'Sin operación';

          const locationBadge = document.getElementById('modalLocationBadge');
          const locationBadgeMobile = document.getElementById('modalLocationBadgeMobile');
          if (locationBadge) locationBadge.textContent = property.location || "Sin ubicación";
          if (locationBadgeMobile) locationBadgeMobile.textContent = property.location || "Sin ubicación";

          const mainImage = document.getElementById('mainImage');
          window.images = Array.isArray(property.images) && property.images.length > 0 ? property.images : ['https://placehold.co/300x200'];
          window.currentImageIndex = 0; // Inicializar el índice
          if (mainImage) mainImage.src = window.images[0];

          const thumbnailContainer = document.getElementById('thumbnailContainer');
          if (thumbnailContainer) {
            thumbnailContainer.innerHTML = '';
            window.images.forEach((image, index) => {
              const thumbnail = document.createElement('img');
              thumbnail.src = image;
              thumbnail.alt = `Miniatura ${index + 1}`;
              thumbnail.className = `thumbnail ${index === 0 ? 'active' : ''}`;
              thumbnail.onclick = (event) => {
                event.preventDefault();
                event.stopPropagation();
                console.log('Clic en miniatura:', index);
                window.currentImageIndex = index;
                window.updateMainImage();
                
                // Abrir modal con la imagen correcta
                const modal = document.getElementById('imageModal');
                const modalImg = document.getElementById('modalImage');
                if (modal && modalImg) {
                  modal.style.display = 'flex';
                  modalImg.src = window.images[index];
                }
              };
              thumbnailContainer.appendChild(thumbnail);
            });
          }

          const locationDetail = document.getElementById('modalLocation');
          if (locationDetail) locationDetail.textContent = property.location || "Sin ubicación";

          const squareMeters = document.getElementById('modalSquareMeters');
          if (squareMeters) squareMeters.textContent = `${property.squareMeters || 0} m²`;

          const bedrooms = document.getElementById('modalBedrooms');
          if (bedrooms) bedrooms.textContent = `${property.bedrooms || 0} dormitorio/s`;

          const bathrooms = document.getElementById('modalBathrooms');
          if (bathrooms) bathrooms.textContent = `${property.bathrooms || 0} baño/s`;

          const description = document.getElementById('modalDescription');
          if (description) {
            const descriptionText = property.detailedDescription || property.description || "Sin descripción";
            description.textContent = descriptionText;
          }

          const owner = document.getElementById('modalOwner');
          if (owner) owner.textContent = property.owner || "Sin propietario";

          const ownerName = document.getElementById('ownerName');
          if (ownerName) ownerName.textContent = property.owner || "Sin nombre";

          const phone = document.getElementById('modalPhone');
          if (phone) phone.textContent = property.phone || "Sin teléfono";

          const phoneNumber = document.getElementById('phoneNumber');
          if (phoneNumber) phoneNumber.textContent = property.phone || "Sin número";

          const whatsappLink = document.getElementById('modalWhatsApp');
          if (whatsappLink && property.phone) {
            const message = `Hola, estoy interesado en la propiedad "${property.title || 'Sin título'}" en ${property.location || 'Sin ubicación'} por ${currencySymbol}${property.price ? property.price.toLocaleString() : 'Consultar'}. ¿Podemos hablar más detalles?`;
            const encodedMessage = encodeURIComponent(message);
            whatsappLink.href = `https://wa.me/${property.phone}?text=${encodedMessage}`;
          } else if (whatsappLink) {
            whatsappLink.href = '#';
            whatsappLink.classList.add('opacity-50', 'pointer-events-none');
            whatsappLink.title = 'Número de teléfono no disponible';
          }

          // El botón de mapa se configura en la función loadPropertyMap

          // Configurar botón de favoritos para móvil
          const favoriteButtonMobile = document.getElementById('favoriteButtonMobile');
          if (favoriteButtonMobile) {
            favoriteButtonMobile.setAttribute('data-property-id', propertyId);
            favoriteButtonMobile.classList.toggle('favorited', isPropertyInFavorites(propertyId));
            favoriteButtonMobile.setAttribute('aria-label', isPropertyInFavorites(propertyId) ? 'Remover de favoritos' : 'Añadir a favoritos');
            favoriteButtonMobile.onclick = (event) => {
              console.log('Clic en favoritos móvil, propertyId:', propertyId);
              event.preventDefault();
              event.stopPropagation();
              toggleFavoriteProperty(propertyId, event);
              // Actualizar ambos botones
              updateFavoriteButtonsState(propertyId);
              updateFavoritesCounter();
            };
          }

          // Configurar botón de favoritos para desktop
          const favoriteButtonDesktop = document.getElementById('favoriteButton');
          if (favoriteButtonDesktop) {
            favoriteButtonDesktop.setAttribute('data-property-id', propertyId);
            favoriteButtonDesktop.classList.toggle('favorited', isPropertyInFavorites(propertyId));
            favoriteButtonDesktop.setAttribute('aria-label', isPropertyInFavorites(propertyId) ? 'Remover de favoritos' : 'Añadir a favoritos');
            favoriteButtonDesktop.onclick = (event) => {
              console.log('Clic en favoritos desktop, propertyId:', propertyId);
              event.preventDefault();
              event.stopPropagation();
              toggleFavoriteProperty(propertyId, event);
              // Actualizar ambos botones
              updateFavoriteButtonsState(propertyId);
              updateFavoritesCounter();
            };
          }

          showLoading(false);
          
          // Cargar el mapa usando iframe
          loadPropertyMap(property);
          
          // Mostrar el footer después de cargar la propiedad
          const mainFooter = document.getElementById('mainFooter');
          if (mainFooter) {
            mainFooter.classList.remove('hidden');
          }
        } else {
          showError("Propiedad no encontrada. La propiedad que buscas no existe o ha sido eliminada.");
          console.log("Verifica que el slug '" + slug + "' exista en la colección 'propiedades' de Firestore.");
          
          // Mostrar el footer incluso si hay error
          const mainFooter = document.getElementById('mainFooter');
          if (mainFooter) {
            mainFooter.classList.remove('hidden');
          }
        }
      } catch (error) {
        console.error("Error al cargar propiedad:", error);
        showError("Error al cargar la propiedad: " + error.message + ". Por favor, intenta de nuevo o contacta al soporte.");
        if (error.code === 'permission-denied') {
          console.log("Revisa las reglas de seguridad en Firestore. Asegúrate de que la colección 'propiedades' permita lecturas.");
        }
        
        // Mostrar el footer incluso si hay error
        const mainFooter = document.getElementById('mainFooter');
        if (mainFooter) {
          mainFooter.classList.remove('hidden');
        }
      }
    };

    let currentImageIndex = 0;
    let images = [];

    // Función para actualizar el estado de ambos botones de favoritos
    function updateFavoriteButtonsState(propertyId) {
      const isFavorited = isPropertyInFavorites(propertyId);
      
      // Actualizar botón móvil
      const favoriteButtonMobile = document.getElementById('favoriteButtonMobile');
      if (favoriteButtonMobile) {
        favoriteButtonMobile.classList.toggle('favorited', isFavorited);
        favoriteButtonMobile.setAttribute('aria-label', isFavorited ? 'Remover de favoritos' : 'Añadir a favoritos');
      }
      
      // Actualizar botón desktop
      const favoriteButtonDesktop = document.getElementById('favoriteButton');
      if (favoriteButtonDesktop) {
        favoriteButtonDesktop.classList.toggle('favorited', isFavorited);
        favoriteButtonDesktop.setAttribute('aria-label', isFavorited ? 'Remover de favoritos' : 'Añadir a favoritos');
      }
    }

    window.updateMainImage = function() {
      const mainImage = document.getElementById('mainImage');
      if (mainImage) {
        mainImage.src = window.images[window.currentImageIndex];
        mainImage.alt = `Imagen ${window.currentImageIndex + 1}`;
      }

      const thumbnails = document.querySelectorAll('.thumbnail');
      thumbnails.forEach((thumbnail, index) => {
        thumbnail.classList.toggle('active', index === window.currentImageIndex);
      });
    };

    window.prevImage = function() {
      window.currentImageIndex = (window.currentImageIndex - 1 + window.images.length) % window.images.length;
      window.updateMainImage();
    };

    window.nextImage = function() {
      window.currentImageIndex = (window.currentImageIndex + 1) % window.images.length;
      window.updateMainImage();
    };

    window.toggleAccordion = function(id) {
      const panel = document.getElementById(`panel-${id}`);
      const icon = document.getElementById(`icon-${id}`);
      if (panel && icon) {
        if (panel.classList.contains('hidden')) {
          panel.classList.remove('hidden');
          icon.textContent = '−';
        } else {
          panel.classList.add('hidden');
          icon.textContent = '+';
        }
      } else {
        console.error(`Panel o icono no encontrado para id: ${id}`);
      }
    };

    function setupImageModal() {
      const modal = document.getElementById('imageModal');
      const modalImg = document.getElementById('modalImage');
      const mainImage = document.getElementById('mainImage');
      const closeBtn = document.getElementsByClassName('close')[0];

      if (mainImage && modal && modalImg && closeBtn) {
        mainImage.onclick = function() {
          modal.style.display = 'flex';
          modalImg.src = window.images[window.currentImageIndex];
        };

        closeBtn.onclick = function() {
          modal.style.display = 'none';
        };

        modal.onclick = function(event) {
          if (event.target === modal) {
            modal.style.display = 'none';
          }
        };
      }
    }

    // Función para convertir enlaces de Google Maps a formato embed
    function convertToEmbedUrl(url) {
      // Si ya es un enlace de embed, devolverlo tal como está
      if (url.includes('google.com/maps/embed')) {
        return url;
      }
      
      // Si es un enlace de maps.app.goo.gl, necesitamos convertirlo
      if (url.includes('maps.app.goo.gl')) {
        // Para enlaces cortos, intentar redirigir a la URL real
        // Por ahora, mostrar mensaje de error ya que no podemos hacer fetch desde el cliente
        console.warn('Los enlaces cortos de Google Maps no se pueden convertir automáticamente');
        return null;
      }
      
      // Si es un enlace de Google Maps normal, intentar convertirlo
      if (url.includes('google.com/maps/')) {
        // Para enlaces normales de Google Maps, intentar crear un embed
        // Esto es más complejo sin API key, así que mejor mostrar el enlace original
        console.warn('Los enlaces normales de Google Maps necesitan ser convertidos manualmente');
        return null;
      }
      
      return url;
    }

    // Función de prueba para cargar un mapa específico
    window.testMap = function(url) {
      console.log("Probando mapa con URL:", url);
      const mapContainer = document.getElementById('propertyMap');
      const mapLoading = document.getElementById('mapLoading');
      const mapError = document.getElementById('mapError');
      const mapIframe = document.getElementById('mapIframe');
      
      // Ocultar todos los estados
      mapContainer.querySelector('#mapPlaceholder').style.display = 'none';
      mapLoading.style.display = 'none';
      mapError.style.display = 'none';
      mapIframe.classList.add('hidden');
      
      // Mostrar loading
      mapLoading.style.display = 'block';
      
      // Configurar iframe
      mapIframe.src = url;
      
      // Eventos
      mapIframe.onload = function() {
        mapLoading.style.display = 'none';
        mapIframe.classList.remove('hidden');
        console.log("✅ Mapa de prueba cargado exitosamente");
      };
      
      mapIframe.onerror = function() {
        mapLoading.style.display = 'none';
        mapError.style.display = 'block';
        console.error("❌ Error al cargar mapa de prueba");
      };
    };

    // Función para cargar el mapa usando iframe
    function loadPropertyMap(property) {
      const mapPlaceholder = document.getElementById('mapPlaceholder');
      const mapLoading = document.getElementById('mapLoading');
      const mapError = document.getElementById('mapError');
      const mapIframe = document.getElementById('mapIframe');
      const openInMapsButton = document.getElementById('openInMaps');
      
      // Ocultar todos los estados
      mapPlaceholder.style.display = 'none';
      mapLoading.style.display = 'none';
      mapError.style.display = 'none';
      mapIframe.classList.add('hidden');
      
      if (property.mapUrl) {
        // Mostrar estado de carga
        mapLoading.style.display = 'block';
        
        // Convertir URL a formato embed
        const embedUrl = convertToEmbedUrl(property.mapUrl);
        
        // Si la conversión falló, mostrar error
        if (!embedUrl) {
          mapLoading.style.display = 'none';
          mapError.style.display = 'block';
          console.error("No se pudo convertir la URL del mapa");
          return;
        }
        
        // Configurar el iframe
        mapIframe.src = embedUrl;
        
        // Eventos para manejar la carga del iframe
        mapIframe.onload = function() {
          // Ocultar loading y mostrar mapa
          mapLoading.style.display = 'none';
          mapIframe.classList.remove('hidden');
          console.log("Mapa cargado exitosamente desde:", embedUrl);
        };
        
        mapIframe.onerror = function() {
          // Mostrar error
          mapLoading.style.display = 'none';
          mapError.style.display = 'block';
          console.error("Error al cargar el mapa desde:", embedUrl);
        };
        
        // Timeout para detectar si el iframe no carga
        setTimeout(() => {
          if (mapLoading.style.display !== 'none') {
            console.warn("Timeout al cargar el mapa, intentando mostrar de todas formas");
            mapLoading.style.display = 'none';
            mapIframe.classList.remove('hidden');
          }
        }, 5000);
        
        // Configurar botón para abrir en Google Maps
        if (openInMapsButton) {
          openInMapsButton.onclick = () => {
            window.open(property.mapUrl, '_blank');
          };
          openInMapsButton.classList.remove('opacity-50', 'pointer-events-none');
          openInMapsButton.title = 'Abrir en Google Maps';
        }
        
        console.log("Cargando mapa desde URL:", property.mapUrl);
        console.log("URL convertida a embed:", embedUrl);
      } else {
        // Si no tiene URL del mapa, mostrar placeholder
        mapPlaceholder.style.display = 'block';
        
        // Deshabilitar botón de abrir en mapa
        if (openInMapsButton) {
          openInMapsButton.classList.add('opacity-50', 'pointer-events-none');
          openInMapsButton.title = 'URL del mapa no disponible';
        }
        
        console.log("No se proporcionó URL del mapa");
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      console.log("DOM cargado, iniciando loadPropertyDetails...");
      window.loadPropertyDetails();
      setupImageModal();
      try {
        updateFavoritesCounter();
      } catch (error) {
        console.error("Error al actualizar el contador de favoritos:", error);
      }

      const copyBtn = document.getElementById('copyLinkButton');
      copyBtn?.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(window.location.href);
          showToast('¡Enlace copiado al portapapeles!', 'success');
        } catch (err) {
          console.error('Error al copiar:', err);
          showToast('Hubo un problema al copiar el enlace.', 'warning');
        }
      });
    });
  </script>
</body>
</html>
</html>
